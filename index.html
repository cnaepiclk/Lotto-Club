<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotto Premium</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        /* --- PREMIUM UI STYLES --- */
        body { font-family: 'Poppins', sans-serif; background-color: #0f172a; color: white; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .app-container { width: 100%; max-width: 420px; background: #1e293b; height: 100vh; display: flex; flex-direction: column; position: relative; overflow: hidden; box-shadow: 0 0 30px #000; }
        .hidden { display: none !important; }

        /* Header */
        .header { 
            background: linear-gradient(135deg, #3b82f6, #8b5cf6); 
            padding: 20px; 
            border-bottom-left-radius: 25px; 
            border-bottom-right-radius: 25px; 
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            z-index: 10;
            flex-shrink: 0;
        }
        .balance-pill { background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); padding: 5px 15px 5px 5px; border-radius: 50px; display: flex; align-items: center; border: 1px solid rgba(255,255,255,0.3); }
        
        .content-area { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 90px; }

        /* Buttons & Inputs */
        .auth-input, .form-input { width: 100%; padding: 15px; margin-bottom: 15px; background: #334155; border: 1px solid #475569; color: white; border-radius: 12px; font-size: 16px; outline: none; text-align: center; box-sizing: border-box; }
        .submit-btn { width: 100%; padding: 15px; background: linear-gradient(90deg, #10b981, #059669); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4); }
        
        /* Package Cards */
        .bet-card { display: flex; justify-content: space-between; align-items: center; padding: 20px; margin-bottom: 15px; border-radius: 18px; color: white; width: 100%; border: none; cursor: pointer; transition: transform 0.2s; position: relative; overflow: hidden; }
        .bet-card:active { transform: scale(0.98); }
        .c-1 { background: linear-gradient(135deg, #0ea5e9, #2563eb); } 
        .c-2 { background: linear-gradient(135deg, #f59e0b, #d97706); } 
        .c-3 { background: linear-gradient(135deg, #ef4444, #b91c1c); }

        /* --- FIXED IMAGE SIZE CSS --- */
        .promo-container { margin-top: 20px; }
        .promo-img { 
            width: 100%; 
            height: 140px; /* Fixed Height */
            object-fit: cover; /* Crops image nicely */
            border-radius: 15px; 
            margin-bottom: 15px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); 
            border: 1px solid #475569; 
            display: block;
        }

        /* Grid */
        .number-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .num-box { aspect-ratio: 1; display: flex; justify-content: center; align-items: center; background: #334155; border: 1px solid #475569; border-radius: 12px; font-weight: bold; cursor: pointer; color: white; font-size: 18px; }
        .num-box.booked { background: #3f2e3e; color: #ef4444; pointer-events: none; border-color: #ef4444; opacity: 0.6; }
        .num-box.gold-num { background: linear-gradient(45deg, #FFD700, #FFA000); color: black; border: 2px solid white; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* History */
        .hist-item { background: #334155; padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid #3b82f6; }

        /* Modals */
        .modal-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; z-index: 100; }
        .modal-box { background: #1e293b; width: 85%; padding: 25px; border-radius: 20px; text-align: center; border: 1px solid #475569; color: white; }

        /* Nav */
        .bottom-nav { position: absolute; bottom: 0; width: 100%; height: 70px; background: #0f172a; display: flex; justify-content: space-around; align-items: center; z-index: 20; border-top: 1px solid #334155; }
        .nav-item { color: #64748b; font-size: 30px; cursor: pointer; } .nav-item.active { color: #3b82f6; }
        
        /* Menu Buttons */
        .menu-btn { background: #334155; color: white; width: 100%; padding: 20px; margin-bottom: 15px; border-radius: 15px; border: none; display: flex; align-items: center; font-size: 16px; font-weight: 600; cursor: pointer; transition: background 0.2s; }
        .menu-btn:active { background: #475569; }
        .menu-icon { margin-right: 15px; font-size: 22px; color: #3b82f6; }
    </style>
</head>
<body>

<div class="app-container">
    <!-- LOGIN -->
    <div id="auth-screen" style="flex:1; display:flex; flex-direction:column; justify-content:center; padding:30px; text-align:center;">
        <h1 style="background: -webkit-linear-gradient(#3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 32px;">LOTTO CLUB</h1>
        <input type="number" id="login-id" class="auth-input" placeholder="User ID">
        <input type="text" id="login-pass" class="auth-input" placeholder="Password">
        <button class="submit-btn" onclick="login()">LOGIN</button>
        <p style="margin-top:20px; color: #94a3b8;">Don't have an account? <b style="color:#3b82f6; cursor:pointer;" onclick="registerUser()">Register</b></p>
    </div>

    <!-- MAIN APP -->
    <div id="app-screen" class="hidden" style="display: flex; flex-direction: column; height: 100%;">
        <div class="header">
            <div><h1 style="margin:0; font-size:20px;">Lotto Club</h1><small style="opacity:0.8">PREMIUM BETTING</small></div>
            <div class="balance-pill"><span style="font-weight:bold; font-size:16px;">Rs. <span id="display-balance">0.00</span></span></div>
        </div>

        <div class="content-area">
            <!-- HOME -->
            <div id="tab-home">
                <div id="package-view">
                    <button class="bet-card c-1" onclick="loadGrid(100)"><h3>Rs. 100</h3><span>Silver</span></button>
                    <button class="bet-card c-2" onclick="loadGrid(1000)"><h3>Rs. 1000</h3><span>Gold</span></button>
                    <button class="bet-card c-3" onclick="loadGrid(5000)"><h3>Rs. 5000</h3><span>VIP</span></button>

                    <!-- PROMO IMAGES -->
                    <div class="promo-container" id="promo-area">
                        <!-- Images injected via JS -->
                    </div>
                </div>
                
                <div id="grid-view" class="hidden">
                    <button onclick="showPackages()" style="margin-bottom:15px; background:none; border:none; color:#94a3b8; cursor:pointer;">â¬… Back to Packages</button>
                    <h2 style="text-align:center; color:#3b82f6;">Rs. <span id="header-amount">0</span></h2>
                    <div class="number-grid" id="numbers-container"></div>
                </div>
            </div>

            <!-- HISTORY -->
            <div id="tab-history" class="hidden">
                <h2>Bet History</h2>
                <div id="history-container"></div>
            </div>

            <!-- MENU (FIXED) -->
            <div id="tab-menu" class="hidden">
                <!-- Main Menu List -->
                <div id="menu-main">
                    <div style="background:#334155; padding:20px; border-radius:15px; margin-bottom:20px; text-align:center;">
                        <small style="color:#94a3b8">User ID</small><h2 style="margin:0; color:#3b82f6;" id="menu-user-id">---</h2>
                    </div>
                    
                    <button class="menu-btn" onclick="showSettings()">
                        <span class="material-icons-round menu-icon">person</span> Profile Settings
                    </button>
                    
                    <button class="menu-btn" onclick="showWithdrawal()">
                        <span class="material-icons-round menu-icon">payments</span> Withdraw Funds
                    </button>
                    
                    <button class="menu-btn" style="color:#ef4444;" onclick="location.reload()">
                        <span class="material-icons-round menu-icon" style="color:#ef4444;">logout</span> Log Out
                    </button>
                </div>
                
                <!-- Settings Sub Form -->
                <div id="settings-form" class="hidden">
                    <h3 style="color:#3b82f6">Edit Profile</h3>
                    <input type="text" id="p-name" class="form-input" placeholder="Full Name">
                    <input type="text" id="p-nic" class="form-input" placeholder="NIC Number">
                    <input type="text" id="p-addr" class="form-input" placeholder="Address">
                    <input type="tel" id="p-phone" class="form-input" placeholder="Phone">
                    <button class="submit-btn" onclick="saveProfile()">Save Changes</button>
                    <button onclick="closeMenuSub()" style="width:100%; padding:15px; margin-top:10px; background:none; border:1px solid #475569; color:#94a3b8; border-radius:12px; cursor:pointer;">Cancel</button>
                </div>

                <!-- Withdraw Sub Form -->
                <div id="withdraw-form" class="hidden">
                    <h3 style="color:#3b82f6">Withdraw</h3>
                    <p>Available Balance: <b id="avail-bal" style="color:#10b981">0.00</b></p>
                    <input type="number" id="w-amount" class="form-input" placeholder="Amount to Withdraw">
                    <button class="submit-btn" onclick="processWithdraw()">Generate Code</button>
                    <button onclick="closeMenuSub()" style="width:100%; padding:15px; margin-top:10px; background:none; border:1px solid #475569; color:#94a3b8; border-radius:12px; cursor:pointer;">Cancel</button>
                </div>
            </div>
        </div>

        <div class="bottom-nav">
            <span class="nav-item active" onclick="switchTab('home', this)"><span class="material-icons-round">home</span></span>
            <span class="nav-item" onclick="switchTab('history', this)"><span class="material-icons-round">history</span></span>
            <span class="nav-item" onclick="switchTab('menu', this)"><span class="material-icons-round">grid_view</span></span>
        </div>
    </div>

    <!-- MODALS -->
    <div id="reg-modal" class="modal-overlay hidden">
        <div class="modal-box">
            <h2 style="color:#10b981;">Registered!</h2>
            <div style="background:#0f172a; padding:15px; border-radius:10px; margin-bottom:15px;">
                ID: <b id="gen-id" style="color:#3b82f6"></b><br>Pass: <b id="gen-pass" style="color:#3b82f6"></b>
            </div>
            <button class="submit-btn" onclick="autoLoginAfterReg()">Continue</button>
        </div>
    </div>

    <div id="bet-modal" class="modal-overlay hidden">
        <div class="modal-box">
            <h2>Place Bet</h2>
            <h1 id="bet-num" style="color:#3b82f6; font-size:50px; margin:10px 0;">00</h1>
            <p style="color:#94a3b8; margin-bottom:5px;">Enter phone number to confirm</p>
            <input type="tel" id="bet-phone" class="form-input" placeholder="07XXXXXXXX">
            <button class="submit-btn" onclick="confirmBet()">CONFIRM BET</button>
            <button style="margin-top:15px; background:none; border:none; color:#94a3b8; cursor:pointer;" onclick="document.getElementById('bet-modal').classList.add('hidden')">Cancel</button>
        </div>
    </div>

    <div id="code-modal" class="modal-overlay hidden">
        <div class="modal-box">
            <h2 style="color:#10b981">Withdraw Code</h2>
            <h1 id="w-code" style="letter-spacing:5px; background:#0f172a; padding:10px; border-radius:10px;">-----</h1>
            <p style="color:#94a3b8; font-size:12px; margin-top:10px;">Show this code to Agent</p>
            <button class="submit-btn" style="margin-top:15px;" onclick="location.reload()">Done</button>
        </div>
    </div>
</div>

<script>
    // --- DEFAULT IMAGES ---
    const defaultImages = [
        "https://i.postimg.cc/BZLD0BVp/1764571610106-019ad8a8-f405-7dbb-b422-a29a335144eb.png",
        "https://i.postimg.cc/90Zrq16d/1764571844622-019ad8ac-ac26-7fb7-bd9b-51109b3950d0.png",
        "https://i.postimg.cc/DzNZjtFM/1764571898728-019ad8ad-fe10-7b9a-bb11-a3fa4c2bd1b1.png"
    ];

    let currentUser = null;
    let currentAmt = 0;
    let selectedNum = '';

    // --- INITIALIZE ---
    function loadPromoImages() {
        const config = JSON.parse(localStorage.getItem('lotto_config') || '{}');
        const imgs = config.images || defaultImages;
        let html = '';
        imgs.forEach(url => { if(url) html += `<img src="${url}" class="promo-img">`; });
        document.getElementById('promo-area').innerHTML = html;
    }

    // --- AUTH ---
    function registerUser() {
        const id = Math.floor(1000000000 + Math.random() * 9000000000).toString();
        const pass = Math.random().toString(36).slice(-5);
        const users = JSON.parse(localStorage.getItem('lotto_users') || '[]');
        users.push({ id, pass });
        localStorage.setItem('lotto_users', JSON.stringify(users));
        
        document.getElementById('gen-id').innerText = id;
        document.getElementById('gen-pass').innerText = pass;
        document.getElementById('reg-modal').classList.remove('hidden');
        currentUser = { id, pass };
    }

    function autoLoginAfterReg() {
        document.getElementById('reg-modal').classList.add('hidden');
        startAppSession();
    }

    function login() {
        const id = document.getElementById('login-id').value;
        const pass = document.getElementById('login-pass').value;
        const users = JSON.parse(localStorage.getItem('lotto_users') || '[]');
        const user = users.find(u => u.id === id && u.pass === pass);
        if(user) {
            currentUser = user;
            startAppSession();
        } else { alert('Invalid Credentials'); }
    }

    function startAppSession() {
        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('app-screen').classList.remove('hidden');
        document.getElementById('menu-user-id').innerText = currentUser.id;
        loadPromoImages();
        updateBal();
        loadHistory();
    }

    function updateBal() {
        const bals = JSON.parse(localStorage.getItem('lotto_balances') || '{}');
        const bal = bals[currentUser.id] || 0;
        document.getElementById('display-balance').innerText = bal.toFixed(2);
        document.getElementById('avail-bal').innerText = bal.toFixed(2);
    }

    function switchTab(tab, el) {
        document.getElementById('tab-home').classList.add('hidden');
        document.getElementById('tab-menu').classList.add('hidden');
        document.getElementById('tab-history').classList.add('hidden');
        document.getElementById('tab-' + tab).classList.remove('hidden');
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
        
        // Reset Menu if switching to it
        if(tab === 'menu') closeMenuSub();
        if(tab === 'history') loadHistory();
    }

    // --- BETTING ---
    function loadGrid(amt) {
        currentAmt = amt;
        document.getElementById('header-amount').innerText = amt;
        document.getElementById('package-view').classList.add('hidden');
        document.getElementById('grid-view').classList.remove('hidden');
        
        const bets = JSON.parse(localStorage.getItem('lotto_bets') || '[]');
        const booked = bets.filter(b => b.amount === amt).map(b => b.num);
        const goldNum = localStorage.getItem('lotto_gold_num');
        const container = document.getElementById('numbers-container');
        container.innerHTML = '';

        for(let i=0; i<=99; i++) {
            let n = i.toString().padStart(2, '0');
            let div = document.createElement('div');
            let classes = 'num-box';
            if(booked.includes(n)) classes += ' booked';
            if(goldNum === n) classes += ' gold-num';
            div.className = classes;
            div.innerText = n;
            if(!booked.includes(n)) {
                div.onclick = () => { 
                    selectedNum = n; 
                    document.getElementById('bet-num').innerText = n;
                    // Auto-fill phone if saved
                    const p = JSON.parse(localStorage.getItem('profile_'+currentUser.id) || '{}');
                    if(p.phone) document.getElementById('bet-phone').value = p.phone;
                    document.getElementById('bet-modal').classList.remove('hidden'); 
                };
            }
            container.appendChild(div);
        }
    }

    function showPackages() { document.getElementById('grid-view').classList.add('hidden'); document.getElementById('package-view').classList.remove('hidden'); }

    function confirmBet() {
        const phone = document.getElementById('bet-phone').value;
        if(!phone) { alert("Please enter your Phone Number!"); return; }

        const bals = JSON.parse(localStorage.getItem('lotto_balances') || '{}');
        const bal = bals[currentUser.id] || 0;
        if(bal < currentAmt) { alert('Insufficient Balance!'); return; }
        
        bals[currentUser.id] = bal - currentAmt;
        localStorage.setItem('lotto_balances', JSON.stringify(bals));

        const bets = JSON.parse(localStorage.getItem('lotto_bets') || '[]');
        const betId = Date.now() + Math.random().toString(16).slice(2);

        bets.push({ 
            id: betId,
            userId: currentUser.id, 
            amount: currentAmt, 
            num: selectedNum, 
            phone: phone, 
            time: new Date().toLocaleString() 
        });
        localStorage.setItem('lotto_bets', JSON.stringify(bets));

        alert('Bet Placed Successfully!');
        document.getElementById('bet-modal').classList.add('hidden');
        updateBal();
        loadGrid(currentAmt);
    }

    function loadHistory() {
        const container = document.getElementById('history-container');
        const bets = JSON.parse(localStorage.getItem('lotto_bets') || '[]');
        const myBets = bets.filter(b => b.userId === currentUser.id).reverse();

        if(myBets.length === 0) { container.innerHTML = '<p style="text-align:center; color:#64748b;">No bets placed yet.</p>'; return; }

        let html = '';
        myBets.forEach(b => {
            html += `
            <div class="hist-item">
                <div><div style="font-weight:bold; color:#3b82f6">Rs. ${b.amount}</div><div style="font-size:12px; color:#94a3b8;">${b.time}</div></div>
                <div style="font-size:24px; font-weight:bold;">${b.num}</div>
            </div>`;
        });
        container.innerHTML = html;
    }

    // --- MENU FIXED LOGIC ---
    function showSettings() {
        document.getElementById('menu-main').classList.add('hidden');
        document.getElementById('settings-form').classList.remove('hidden');
        loadProfile();
    }

    function showWithdrawal() {
        document.getElementById('menu-main').classList.add('hidden');
        document.getElementById('withdraw-form').classList.remove('hidden');
    }

    function closeMenuSub() {
        document.getElementById('settings-form').classList.add('hidden');
        document.getElementById('withdraw-form').classList.add('hidden');
        document.getElementById('menu-main').classList.remove('hidden');
    }

    function loadProfile() {
        const p = JSON.parse(localStorage.getItem('profile_'+currentUser.id) || '{}');
        document.getElementById('p-name').value = p.name || '';
        document.getElementById('p-nic').value = p.nic || '';
        document.getElementById('p-addr').value = p.addr || '';
        document.getElementById('p-phone').value = p.phone || '';
    }

    function saveProfile() {
        const p = { name: document.getElementById('p-name').value, nic: document.getElementById('p-nic').value, addr: document.getElementById('p-addr').value, phone: document.getElementById('p-phone').value };
        localStorage.setItem('profile_'+currentUser.id, JSON.stringify(p));
        alert('Profile Saved!'); 
        closeMenuSub();
    }

    function processWithdraw() {
        const amt = parseFloat(document.getElementById('w-amount').value);
        const bals = JSON.parse(localStorage.getItem('lotto_balances') || '{}');
        const bal = bals[currentUser.id] || 0;
        if(!amt || bal < amt) { alert('Invalid Amount or Insufficient Balance'); return; }
        
        bals[currentUser.id] = bal - amt;
        localStorage.setItem('lotto_balances', JSON.stringify(bals));

        const code = Math.floor(10000 + Math.random() * 90000).toString();
        const reqs = JSON.parse(localStorage.getItem('lotto_withdrawals') || '[]');
        reqs.push({ code, uid: currentUser.id, amount: amt, status: 'pending' });
        localStorage.setItem('lotto_withdrawals', JSON.stringify(reqs));
        
        document.getElementById('w-code').innerText = code;
        document.getElementById('code-modal').classList.remove('hidden');
        updateBal();
    }
</script>
</body>
</html>
